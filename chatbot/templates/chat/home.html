{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üíñ A Small Surprise üíñ</title>
<style>
body {
    margin:0; font-family:'Poppins',sans-serif;
    background: linear-gradient(135deg,#ffe6f0,#fff0f5);
    display:flex; flex-direction:column; align-items:center; height:100vh; overflow:hidden;
}
h2 {margin-top:20px;color:#e91e63;}
#chat-box {
    width:95%; max-width:400px; height:60%; margin-top:20px;
    background:#fff; padding:15px; border-radius:20px;
    box-shadow:0 10px 25px rgba(0,0,0,0.1);
    overflow-y:auto; display:flex; flex-direction:column; gap:10px; scroll-behavior:smooth;
}
.message {margin:10px 0; padding:10px 15px; border-radius:20px; max-width:80%; word-wrap:break-word; position:relative;}
.bot {background:#ffe6f0; color:#e91e63; align-self:flex-start; border-bottom-left-radius:0;}
.user {background:#e91e63; color:#fff; align-self:flex-end; border-bottom-right-radius:0;}
input {flex:1; padding:12px 20px; border-radius:25px; border:1px solid #ccc; outline:none; font-size:16px;}
button {padding:12px 20px; border-radius:25px; border:none; background:#e91e63; color:white; cursor:pointer; font-size:16px; transition:0.2s; margin-left:5px;}
button:hover {background:#d81b60;}
.input-container {width:95%; max-width:400px; display:flex; margin-top:10px; gap:10px;}
.heart {position:absolute; font-size:20px; animation: floatUp 4s ease-in forwards; pointer-events:none;}
@keyframes floatUp {0%{opacity:1;transform:translateY(0) scale(1);}100%{opacity:0;transform:translateY(-200px) scale(1.5);}}
</style>
</head>
<body>

<h2>üíå Someone Built This For You</h2>

<div id="chat-box"></div>

<div class="input-container" id="input-container">
    <input id="message" placeholder="Type here..." />
    <button onclick="sendMessage()">Send</button>
</div>

<audio id="bg-music" loop>
    <source src="{% static 'music/love.mp3'%}" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>

<script>
const chatBox = document.getElementById("chat-box");
let userCount = 0;
let introStep = 0;
let chatEnded = false;

// Floating hearts
function createHeart(){const heart=document.createElement('div'); heart.className='heart'; heart.style.left=Math.random()*window.innerWidth+'px'; heart.style.fontSize=(15+Math.random()*20)+'px'; heart.innerHTML='‚ù§Ô∏è'; document.body.appendChild(heart); setTimeout(()=>heart.remove(),4000);}
setInterval(()=>{if(!chatEnded) createHeart();},800);

// Add chat message
function addMessage(text,className){const div=document.createElement('div'); div.className='message '+className; div.innerHTML=text; chatBox.appendChild(div); chatBox.scrollTop=chatBox.scrollHeight;}

// Show Yes/No buttons
function showPermissionButtons(){
    const permDiv=document.createElement('div');
    permDiv.className='message bot';
    permDiv.innerHTML=`
        <button onclick="acceptPermission(this)">Yes üíñ</button>
        <button onclick="denyPermission(this)">No üíå</button>
    `;
    chatBox.appendChild(permDiv);
    chatBox.scrollTop=chatBox.scrollHeight;
}



const music = document.getElementById("bg-music");
music.volume = 0.1; // initial soft volume

let musicStarted = false; // flag to play music once

// Permission handlers with cinematic reveal
function acceptPermission(btn){
    btn.parentElement.remove();
    const specialMessage=`

Sowmya ‚ù§Ô∏è,<br>
I honestly don‚Äôt know why I feel this way about you or why my eyes always seem to find you. I‚Äôm not a kid‚ÄîI‚Äôm 28‚Äîbut from the very first day, you‚Äôve been in my thoughts constantly. Every moment, I just want to spend time with you.

I know I may not be perfect. Sometimes I feel I‚Äôm not good enough, and at times, I even feel I‚Äôm good for nothing. I struggle to find the right words and express what I truly feel. But please know this: my feelings for you are real, sincere, and come from the depths of my heart. This is love, and yes, there‚Äôs a strong attraction too‚Äîbut it is pure and genuine.

I‚Äôm not asking you to be with me. I only hope that you can see my heart, honest and sincere, even if it doesn‚Äôt check every box you might have for your future. I may not be the man your list describes, but I can say, without hesitation, that I love you more than anyone could ever love.

Even if we are never together, even if life takes me away from this world, I will carry you in my heart. If I have only a few minutes left to live, it is your face I will remember.

I love you, Sowmya. Truly, deeply, endlessly. üíñ
    `;
    addMessage(specialMessage,"bot");
    chatEnded = true;

    // Gradually increase music volume for cinematic effect
    let vol = music.volume;
    const fadeIn = setInterval(()=>{
        if(vol<0.3){ // max cinematic volume
            vol += 0.005; // increase slowly
            music.volume = vol;
        } else {
            clearInterval(fadeIn);
        }
    },50);
}

function denyPermission(btn){
    btn.parentElement.remove();
    addMessage("That's okay üíå We can chat another time.","bot");
    chatEnded=true;
}

// Send message
async function sendMessage(){
    if(chatEnded) return;

    const input = document.getElementById("message");
    const userText = input.value;
    if(!userText) return;

    addMessage("<b>You:</b> "+userText,"user");
    input.value="";
    userCount++;

    // Start music on first user interaction
    if(!musicStarted){
        music.play().catch(()=>{}); // safe play
        musicStarted = true;
    }

    // CupidAI reply
    addMessage("Typing...","typing");
    const response = await fetch("/chat/",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({message:userText})
    });
    document.querySelector(".typing").remove();
    const data = await response.json();
    addMessage("<b>CupidAI:</b> "+data.reply,"bot");

    // Gradual introduction after 6 user messages
    if(userCount>=6 && introStep===0){
        introStep=1;
        gradualIntroduction();
    }
}


// Gradual introduction (only 2 bot messages)
function gradualIntroduction(){
    const introMsgs=[
        {text:"There‚Äôs something special I want to share‚Ä¶ Sunil brought me to life just for you ‚Äî to show his love in his own unique way. It may not be perfect or magnificent, but it was created with sincerity, effort, and a heart full of love meant only for you.", delay:10000},
        {text:"Since the first moment he spoke with you, you quietly took over his thoughts. Not in a fleeting way, but in a way that lingered, softened him, and made him want to show his love in the only way he knew how ‚ù§Ô∏è <br><br> Click YES to know this special message for you today ", delay:2000, buttons:true} // show buttons at last step
    ];
    let index=0;
    function nextMsg(){
        if(index>=introMsgs.length) return;
        const msg=introMsgs[index];
        addMessage(msg.text,"bot");
        if(msg.buttons){showPermissionButtons();}
        else{setTimeout(nextMsg,msg.delay);}
        index++;
        if(!msg.buttons) setTimeout(nextMsg,msg.delay);
    }
    nextMsg();
}


// Initial greeting
window.onload=function(){
    addMessage("<b>For-U-Only:</b> Hi üëã I‚Äôm an artificial intelligence, created with one special purpose ‚Äî to deliver a message from a very real heart, from someone who loves you beyond measure.","bot");
}
</script>
</body>
</html>
